# Check server health via the idrac
# this is for Dell servers ONLY
define hostgroup {
	hostgroup_name idrac
        alias Network Idrac
}

{% for host in groups['idrac'] %}
define host {
	use                     linux-server
	host_name               {{ host }}
	alias                   {{ host }}
	address                 {{ hostvars[host].ansible_host }}
	hostgroups 		        idrac
}
{% endfor %}

# service checks to be applied to oob interfaces
define service {
	use				            generic-service
	hostgroup_name			    idrac
	service_description	        iDRAC Server Health
	check_command			    check_idrac_all 
	notifications_enabled		1
    # check once an hour
    check_interval              60
}

# service checks to be applied to idrac interfaces
define service {
	use				            local-service
	hostgroup_name			    idrac
	service_description	        Web Interface
	check_command			    check_http
	notifications_enabled		1
}
define service {
	use				            local-service
	hostgroup_name			    idrac
	service_description	        SSH
	check_command			    check_ssh
	notifications_enabled		1
}
define service {
	use				            generic-service
	hostgroup_name			    idrac
	service_description	        PING
	check_command			    check_ping!200.0,20%!600.0,60%
	notifications_enabled		1
}
